using System.Data.OleDb;
using System.Windows.Forms.DataVisualization.Charting;


		OleDbCommand komanda;
        OleDbConnection konekcija;
        OleDbDataReader rider;
        string series = "Broj citaoca";
		
		//relative paths of base linking
			string putanja = Environment.CurrentDirectory;
            string[] putanjaBaze = putanja.Split(new string[] { "bin" }, StringSplitOptions.None);
            AppDomain.CurrentDomain.SetData("DataDirectory", putanjaBaze[0]);
            konekcija = new OleDbConnection(@"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=|DataDirectory|\DVDkolekcija.accdb");
			
		//formload
		
			konekcija.Open();
            komanda = new OleDbCommand("Select KnjigaID, Naziv from KNJIGA order by KnjigaID", konekcija);
            rider = komanda.ExecuteReader();
            while(rider.Read())
            {
                comboBox1.Items.Add(rider[0].ToString() + " - " + rider[1].ToString());
            }
            comboBox1.Text = "Izaberite knjigu:";
            konekcija.Close();
            chart1.Series.Clear();
            chart1.Legends.Clear();
            chart1.Series.Add(series);
            chart1.Series[series].ChartType = SeriesChartType.FastLine;
            chart1.ChartAreas[0].AxisX.Minimum = 0;
            chart1.ChartAreas[0].AxisX.Maximum = 12;
            chart1.ChartAreas[0].AxisX.Interval = 2;
            chart1.ChartAreas[0].AxisY.Minimum = 0;
            chart1.ChartAreas[0].AxisY.Maximum = 6;
            chart1.ChartAreas[0].AxisY.Interval = 1;
            chart1.ChartAreas[0].AxisX.CustomLabels.Add(1.5, 2.5, "Februar");
            chart1.ChartAreas[0].AxisX.CustomLabels.Add(3.5, 4.5, "April");
            chart1.ChartAreas[0].AxisX.CustomLabels.Add(5.5, 6.5, "Jun");
            chart1.ChartAreas[0].AxisX.CustomLabels.Add(7.5, 8.5, "Avgust");
            chart1.ChartAreas[0].AxisX.CustomLabels.Add(9.5, 10.5, "Oktobar");
            chart1.ChartAreas[0].AxisX.CustomLabels.Add(11.5, 12.5, "Decembar");
            chart1.Legends.Add("Broj clanova");
			
		//view data
		 chart1.Series[series].Points.Clear();
            if (comboBox1.Text == "Izaberite knjigu:")
            {
                MessageBox.Show("Morate izabrati knjigu!");
                return;
            }
            int godina;
            try
            {
                godina = Convert.ToInt32(textBox1.Text);
            }
            catch
            {
                MessageBox.Show("Godina mora biti broj!");
                textBox1.Text = "";
                return;
            }

            if(godina>DateTime.Now.Year)
            {
                MessageBox.Show("Morate uneti godinu manju od 2018!");
                textBox1.Text = "";
                return;
            }

            string[] splitter = new string[5];
            int id;
            splitter = comboBox1.Text.Split(' ');
            id = Convert.ToInt32(splitter[0]);
            DataPoint point;
            double y;
            konekcija.Open();
            for(int i=1;i<=12;i++)
            {
                komanda = new OleDbCommand("Select COUNT(*) FROM (select DISTINCT CitalacID from(SELECT * FROM Na_citanju where KnjigaID=@id AND year(DatUz)=@y AND month(DatUz)=@m))", konekcija);
                komanda.Parameters.AddWithValue("@id", id);
                komanda.Parameters.AddWithValue("@y", godina);
                komanda.Parameters.AddWithValue("@m", i);
                rider = komanda.ExecuteReader();
                rider.Read();
                y = Convert.ToDouble(rider[0].ToString());
                point = new DataPoint(i, y);
                chart1.Series[series].Points.Add(point);
                

            }
            konekcija.Close();