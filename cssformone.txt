using System.Data.OleDb;


		OleDbConnection konekcija;
        OleDbCommand komanda;
        OleDbDataReader rider;
		
	//relative paths of base linking
			string putanja = Environment.CurrentDirectory;
            string[] putanjaBaze = putanja.Split(new string[] { "bin" }, StringSplitOptions.None);
            AppDomain.CurrentDomain.SetData("DataDirectory", putanjaBaze[0]);
            konekcija = new OleDbConnection(@"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=|DataDirectory|\DVDkolekcija.accdb");

	//loading form
	
			button1.Enabled = false;
            button2.Enabled = false;
            konekcija.Open();
            komanda = new OleDbCommand("Select Naziv from KATEGORIJA", konekcija);
            rider = komanda.ExecuteReader();
            while(rider.Read())
            {
                comboBox1.Items.Add(rider[0].ToString());
            }
            konekcija.Close();
			
	//data entry in the database
			if (textBox1.Text=="" || textBox2.Text=="" || comboBox1.Text=="")
            {
                MessageBox.Show("Morate uneti obavezna polja (sifru, naziv i kategoriju knjige)!", "INFORMACIJA");
                textBox2.Text = textBox3.Text = textBox4.Text = comboBox1.Text = textBox1.Text = "";
            }
            else
            {
                konekcija.Open();
                komanda = new OleDbCommand("Insert into KNJIGA (KnjigaID, Naziv, BrojStrana, KategorijaID, Komentar) values (@id, @nzv, @br, @ktg, @kom)", konekcija);
                komanda.Parameters.AddWithValue("@id", textBox1.Text);
                komanda.Parameters.AddWithValue("@nzv", textBox2.Text);
                if(textBox3.Text!="")
                {
                    komanda.Parameters.AddWithValue("@br", textBox3.Text);
                }
                else
                {
                    komanda.Parameters.AddWithValue("@br", DBNull.Value);
                }
                
                komanda.Parameters.AddWithValue("@ktg", comboBox1.SelectedIndex);
                
             
                
                if (textBox4.Text != "")
                {
                    komanda.Parameters.AddWithValue("@kom", textBox4.Text);
                }
                else
                {
                    komanda.Parameters.AddWithValue("@kom", DBNull.Value);
                }

                try
                {
                    komanda.ExecuteNonQuery();
                    MessageBox.Show("Upis uspesan!");
                    textBox2.Text = textBox3.Text = textBox4.Text = comboBox1.Text = textBox1.Text = "";

                }
                catch
                {
                    MessageBox.Show("Doslo je do greske pri upisu!", "GRESKA");
                    textBox2.Text = textBox3.Text = textBox4.Text = comboBox1.Text = textBox1.Text = "";

                }
                konekcija.Close();
                textBox2.Text = textBox3.Text = textBox4.Text = comboBox1.Text = textBox1.Text = "";

	//deleting data from the database

 if (textBox1.Text!="" && textBox2.Text!="")
            {
                konekcija.Open();
                komanda = new OleDbCommand("DELETE * from KNJIGA where KnjigaID=" + Convert.ToInt32(textBox1.Text), konekcija);
                try
                {
                    komanda.ExecuteNonQuery();
                    MessageBox.Show("Uspesno brisanje!");
                }
                catch
                {
                    MessageBox.Show("Doslo je do greske pri brisanju!", "GRESKA");
                }
                konekcija.Close();
                textBox2.Text = textBox3.Text = textBox4.Text = comboBox1.Text = textBox1.Text="";

            }
            else if(textBox1.Text!="" && textBox2.Text=="")
            {
                MessageBox.Show("Uneti ID ne postoji u bazi!", "GRESKA");
                textBox1.Text = "";
            }
            else 
            {
                MessageBox.Show("Morate uneti sifru knjige koju zelite da obrisete!", "INFORMACIJA");
            }
            textBox2.Text = textBox3.Text = textBox4.Text = comboBox1.Text = textBox1.Text = "";

			
		//radiobuttononechecked
		
			textBox2.Text = textBox3.Text = textBox4.Text = comboBox1.Text = textBox1.Text = "";

            button1.Enabled = true;
            button2.Enabled = false;
            textBox2.Enabled = textBox3.Enabled = textBox4.Enabled = comboBox1.Enabled = true;
       
	   //radiobuttontwochecked
	   
			textBox2.Text = textBox3.Text = textBox4.Text = comboBox1.Text = textBox1.Text = "";

            button1.Enabled = false;
            button2.Enabled = true;
            textBox2.Enabled = textBox3.Enabled = textBox4.Enabled = comboBox1.Enabled = false;
        
		//textchange
		
		if (radioButton2.Checked == true)
            {
                if (textBox1.Text != "")
                {

                    int id = 0;
                    bool ima = false;
                    try
                    {
                        id = Convert.ToInt32(textBox1.Text);
                    }
                    catch
                    {
                        MessageBox.Show("Uneti id mora biti broj i to pozitivan! Unesite ponovo.", "GRESKA");
                        textBox1.Text = "";
                    }
                    konekcija.Open();
                    komanda = new OleDbCommand("Select * from KNJIGA", konekcija);
                    rider = komanda.ExecuteReader();
                    while (rider.Read())
                    {
                        if (id == Convert.ToInt32(rider[0].ToString()))
                        {
                            ima = true;
                            break;
                        }
                    }

                    if (ima == true)
                    {
                        textBox2.Text = rider[1].ToString();
                        textBox3.Text = rider[2].ToString();
                        comboBox1.SelectedItem = comboBox1.Items[Convert.ToInt32(rider[3].ToString())-1];
                        textBox4.Text = rider[4].ToString();
                    }
                    else
                    {
                        textBox2.Text = textBox3.Text = textBox4.Text = comboBox1.Text = "";
                    }
                    konekcija.Close();
                }
                else
                {
                    textBox1.Text = "";
                }
            }